<!DOCTYPE html> 
<html> 
<head> 
<style>
#heading{
 position:absolute;
 text-align:center;
 width:100vw;
}
</style> 
</head>
<body> 


<div id='heading'>
 <h1 style ='color:pink'>My Truck</h1>
</div>

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://threejs.org/build/three.min.js"></script>

<script type ="module">
javascript:(function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='https://mrdoob.github.io/stats.js/build/stats.min.js';document.head.appendChild(script);})()

import * as THREE from 'https://unpkg.com/three/build/three.module.js';
import { OrbitControls } from 'https://unpkg.com/three/examples/jsm/controls/OrbitControls.js';


// my script

var renderer, camera, scene; 
var axes,frame;

//new

var raycaster;
var mouse = new THREE.Vector2();
var pickables = [];



init(); 
animate(); 

function init() { 

 renderer = new THREE.WebGLRenderer ({antialias: true}); 
 renderer.setSize (window.innerWidth,window.innerHeight); 
 renderer.setClearColor (0x888888); 
 document.body.appendChild (renderer.domElement); 
 
 camera = new THREE.PerspectiveCamera (100, window.innerWidth/window.innerHeight, 1, 1000);
 camera. position.z = 50;// (0,0,50) 
 

 var controls = new OrbitControls (camera, renderer.domElement);
 
 axes = new THREE.AxesHelper(30);
 
 scene = new THREE.Scene(); 
 var grid = new THREE.GridHelper (100, 10, 'red', 'white');
 scene. add (grid);
 scene. add (axes);
 
 var light = new THREE.SpotLight(0xffffff); //打光
 var spotLightHelper = new THREE.SpotLightHelper(light);
 light.position.set (-20,50,0);
 scene.add(light,spotLightHelper);
 
 var light2 = new THREE.AmbientLight(0x404040);
 scene.add(light2);
 
 frame = new THREE.Object3D();
 frame.position.set(-5,0,-12.5);
 scene.add(frame);
 truck();
 
 //new 
  pickables = [frame];
  raycaster = new THREE.Raycaster();
  document.addEventListener('pointerdown', onDocumentMouseDown, false);
  
} 

function onDocumentMouseDown(event) {

  // PICKING DETAILS: 
  // convert mouse.xy = [-1,1]^2 (NDC)
  // unproject (mouse.xy, 1) to a point on the far plane (in world coordinate)
  // set raycaster (origin, direction)
  // find intersection objects, (closest first) 
  // each record as
  // [ { distance, point, face, faceIndex, object }, ... ]

  event.preventDefault();
  mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
  mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

  // find intersections
  raycaster.setFromCamera(mouse, camera);
  var intersects = raycaster.intersectObjects(pickables);
  if (intersects.length > 0) {
   frame.position.copy(intersects[0].point);
  }

}

function truck(){
	
	//ExtrudeGeometry
	var length = 0.5, width = 0.5;
	var shape = new THREE.Shape();
	shape.moveTo( 0,0 );
	shape.lineTo( 0, width );
	shape.lineTo( length, width );
	shape.lineTo( length, 0 );
	shape.lineTo( 0, 0 );

	var extrudeSettings = {
		steps: 2, //側面三角形
		depth: 2.5, //長方體長度
		bevelEnabled: true,
		bevelThickness: 1,//頭的斜角長度
		bevelSize: 2.1,//長方體寬度
		bevelOffset: 0, //頭的正面
		bevelSegments: 1//斜角三角形
	};
	
	var egeometry = new THREE.ExtrudeGeometry( shape, extrudeSettings );
	var material = new THREE.MeshPhongMaterial( { color: 0x00ffff } );
	var extrude = new THREE.Mesh( egeometry, material ) ;
	extrude.position.set(4.3,9,23);
	
	//head1
	var h1geometry = new THREE.BoxGeometry(5,5,5); //geometry 幾何 y-2.5
	var material = new THREE.MeshPhongMaterial( { color: 0x2894FF } );
	var head1 = new THREE.Mesh( h1geometry,material);
	head1.position.set(4.5,10,22.5);
	//head2
	var h2geometry = new THREE.BoxGeometry(5,5,10); //geometry 幾何 y-2.5
	var material = new THREE.MeshPhongMaterial( { color: 0x46A3FF } );
	var head2 = new THREE.Mesh( h2geometry,material);
	head2.position.set(4.5,5,25);
	//body
	var bgeometry = new THREE.BoxGeometry(5,13,20); //geometry 幾何 y-2.5
	var material = new THREE.MeshPhongMaterial( { color: 0x0066CC } );
	var body = new THREE.Mesh( bgeometry,material);
	body.position.set(4.5,9,10);
	//wheel
	var cgeometry = new THREE.CylinderGeometry(2.5,2.5,2,64);// 半徑+2.5 高-5
	var material = new THREE.MeshPhongMaterial( { color: 0x000000 } );
	var wheel = new THREE.Mesh(cgeometry,material);
	var wheel2 = wheel.clone();
	var wheel3 = wheel.clone();
	var wheel4 = wheel.clone();
	
	wheel.position.set(8, 2.5, 25); //x,y,z 左邊 y+2.5
	wheel2.position.set(1, 2.5, 25);
	wheel3.position.set(8, 2.5, 5);
	wheel4.position.set(1, 2.5, 5);
	
	wheel.rotation.z = Math.PI / 2;
	wheel2.rotation.z = Math.PI / 2;
	wheel3.rotation.z = Math.PI / 2;
	wheel4.rotation.z = Math.PI / 2;
	
	frame.add(extrude);
	frame.add(head1,head2,body,wheel,wheel2,wheel3,wheel4);
}


function animate() {

 renderer.render (scene, camera); 
 requestAnimationFrame( animate ); 

}



</script> 

</body>